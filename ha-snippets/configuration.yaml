# ============================================================
# Home Assistant — Configuração global Bluetooth
# Adicionar ao configuration.yaml (uma única vez).
# Quando adicionar uma nova divisão, actualizar:
#   1. input_boolean abaixo
#   2. mapeamento de IPs nos dois scripts
# ============================================================


# --- Entidades dummy para os cards tile (uma por divisão) ---
# Não controlam nada — servem apenas de base visual para o tile card.

input_boolean:
  bt_escritorio:
    name: "BT Escritório"
    icon: mdi:speaker-bluetooth
  bt_suite:
    name: "BT Suite"
    icon: mdi:speaker-bluetooth
  bt_cozinha:
    name: "BT Cozinha"
    icon: mdi:speaker-bluetooth
  bt_sala:
    name: "BT Sala"
    icon: mdi:speaker-bluetooth
  bt_wcsuite:
    name: "BT WC Suite"
    icon: mdi:speaker-bluetooth
  bt_quartocriancas:
    name: "BT Quarto Crianças"
    icon: mdi:speaker-bluetooth
  bt_quartodesporto:
    name: "BT Quarto Desporto"
    icon: mdi:speaker-bluetooth
  bt_teste:
    name: "BT Teste"
    icon: mdi:speaker-bluetooth


# --- Shell commands (partilhados, não tocar) ---

shell_command:
  bt_pair:   "ssh -i /root/.ssh/id_ed25519 -o StrictHostKeyChecking=no {{ user }}@{{ ip }} '/usr/local/bin/bluetooth-control.sh pair'"
  bt_unpair: "ssh -i /root/.ssh/id_ed25519 -o StrictHostKeyChecking=no {{ user }}@{{ ip }} '/usr/local/bin/bluetooth-control.sh unpair'"


# --- Scripts (um único por acção, recebe divisao como argumento) ---

script:
  bt_pair:
    alias: "BT Ligar"
    fields:
      divisao:
        description: "Nome da divisão (escritorio, suite, cozinha, ...)"
        required: true
    sequence:
      - action: shell_command.bt_pair
        data:
          user: relvasantos
          ip: >-
            {% set ips = {
              'escritorio':    '192.168.30.7',
              'suite':         '192.168.30.2',
              'cozinha':       '192.168.30.3',
              'sala':          '192.168.30.4',
              'wcsuite':       '192.168.30.5',
              'quartocriancas':'192.168.30.6',
              'quartodesporto':'192.168.30.1',
              'teste':         '192.168.30.8'
            } %}
            {{ ips[divisao] }}
    mode: parallel
    max: 8

  bt_unpair:
    alias: "BT Desligar"
    fields:
      divisao:
        description: "Nome da divisão (escritorio, suite, cozinha, ...)"
        required: true
    sequence:
      - action: shell_command.bt_unpair
        data:
          user: relvasantos
          ip: >-
            {% set ips = {
              'escritorio':    '192.168.30.7',
              'suite':         '192.168.30.2',
              'cozinha':       '192.168.30.3',
              'sala':          '192.168.30.4',
              'wcsuite':       '192.168.30.5',
              'quartocriancas':'192.168.30.6',
              'quartodesporto':'192.168.30.1',
              'teste':         '192.168.30.8'
            } %}
            {{ ips[divisao] }}
    mode: parallel
    max: 8
