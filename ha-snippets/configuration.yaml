# ============================================================
# Home Assistant — Configuração global Bluetooth
# Adicionar ao configuration.yaml (uma única vez).
# Quando adicionar uma nova divisão, actualizar o mapeamento
# de IPs nos dois scripts abaixo.
# ============================================================


# --- Shell commands (partilhados, não tocar) ---

shell_command:
  bt_pair:   "ssh -i /root/.ssh/id_ed25519 -o StrictHostKeyChecking=no {{ user }}@{{ ip }} '/usr/local/bin/bluetooth-control.sh pair'"
  bt_unpair: "ssh -i /root/.ssh/id_ed25519 -o StrictHostKeyChecking=no {{ user }}@{{ ip }} '/usr/local/bin/bluetooth-control.sh unpair'"


# --- Scripts (um único por acção, recebe divisao como argumento) ---

script:
  bt_pair:
    alias: "BT Ligar"
    fields:
      divisao:
        description: "Nome da divisão (escritorio, suite, cozinha, ...)"
        required: true
    sequence:
      - action: shell_command.bt_pair
        data:
          user: relvasantos
          ip: >-
            {% set ips = {
              'escritorio':    '192.168.30.7',
              'suite':         '192.168.30.2',
              'cozinha':       '192.168.30.3',
              'sala':          '192.168.30.4',
              'wcsuite':       '192.168.30.5',
              'quartocriancas':'192.168.30.6',
              'quartodesporto':'192.168.30.1'
            } %}
            {{ ips[divisao] }}
    mode: parallel
    max: 7

  bt_unpair:
    alias: "BT Desligar"
    fields:
      divisao:
        description: "Nome da divisão (escritorio, suite, cozinha, ...)"
        required: true
    sequence:
      - action: shell_command.bt_unpair
        data:
          user: relvasantos
          ip: >-
            {% set ips = {
              'escritorio':    '192.168.30.7',
              'suite':         '192.168.30.2',
              'cozinha':       '192.168.30.3',
              'sala':          '192.168.30.4',
              'wcsuite':       '192.168.30.5',
              'quartocriancas':'192.168.30.6',
              'quartodesporto':'192.168.30.1'
            } %}
            {{ ips[divisao] }}
    mode: parallel
    max: 7
